Cilantro: Performance-Aware Resource Allocation for General Objectives via Online Feedback

**研究背景**

用于在竞争作业中分配有限资源的传统系统有以下两种方式，但忽略了作业运行的真实性能

- 基于用户指定的资源需求下确保公平性
- 通过一些替代的指标如CPU利用率来估计这些需求

作者认为当前的资源分配系统应该直接考虑作业的真实性能和用户的不同分配目标。基于此提出了 Cilantro [sɪˈlæn.trəʊ]。

影响业务的真实性能指标（real-world metrics），如服务工作的 P99 延迟或吞吐量，以及服务性能指标 service level objective (SLO)



**研究问题**

性能感知的资源调度策略的难点

1. **从资源到性能的映射在实践中可靠性低**

2. **希望可以支持不同用户定义的不同调度目标**

基于此，作者提出 Cilantro，在竞争作业中对单一可替代资源类型（例如 CPU、容器）进行性能感知分配的框架

![image-20230706104427521](C:\Users\苏铄淼\AppData\Roaming\Typora\typora-user-images\image-20230706104427521.png)



**研究内容**

Cilantro 考虑的是一种传统的固定资源集群管理下的资源分配调度

**系统框架**

![image-20230706160907019](C:\Users\苏铄淼\AppData\Roaming\Typora\typora-user-images\image-20230706160907019.png)

Cilantro 是一种**性能感知调度框架**，可以针对各种调度目标进行优化，而不需要任何工作负载的资源性能映射的先验知识。

Cilantro 的设计基于以下两个关键见解

- **资源性能的离线分析还不够**，需要通过在线学习以适应如服务器、应用程序性能的变化
- **学习机制和策略的解耦可以实现不同的调度目标**。**将学习机制与策略分离允许模型学习一次并应用于多个分配目标。**这种解耦还提高了调度程序做出的分配决策的透明度并有利于调试。

Cilantro 由两个关键组件组成

- 集中式 Cilantro 调度程序，负责生成资源分配，采用在线学习来创建越来越准确的作业绩效和负载模型，通过轮询这些模型的资源性能估计来优化用户定义的目标
- Cilantro 客户端，与每个作业位于同一位置的轻量级 sidecar，获取作业的性能指标并将其发送到 Cilantro 调度程序

**Cilantro 调度程序**调度器的模块，

- 数据记录器。从 Cilantro 客户端推送的**应用程序指标**存储在内存支持的表中。他们将这些指标**转发给性能学习器和负载预测者**。 

- **性能学习器**。**性能学习器根据资源分配和负载使用相关模型，学习作业性能与这些因素之间的关系。**它定期轮询数据记录器以获取新数据并更新模型。学习器的更新频率仅受模型更新速度的限制。每个应用程序维护一个性能学习器实例。

- 负载预测器。负载预测器通过数据记录器的轮询定期更新。 
- 不确定性感知策略。该策略通过计算资源分配来优化用户指定的调度目标。在在线环境中，直接使用性能的估计可能会失败，因为它没有反映模型中的不确定性。因此，**Cilantro的策略利用这些估计的置信区间**，以一种有原则的方式考虑不确定性，从而在进行资源分配决策时进行调整。
- 资源分配器。资源分配器负责通过与底层集群管理器进行交互来执行资源分配。该模块通过分配到期事件来驱动，一旦发生该事件，它就调用策略的compute-alloc方法并分配资源。分配到期事件是基于超时引发的，从而导致新一轮的资源分配。**在实践中，分配周期的持续时间受环境的敏捷性限制**。由于扩展作业需要时间，在过于频繁地更改资源分配之前可能会导致作业频繁启停（在有机会利用新资源之前需要缩减）。

**Cilantro 客户端**：Cilantro 客户端是一个轻量级的 side-car 容器，其目的是轮询作业以获取其当前性能、对其进行处理并将其发布到调度程序的数据记录器。客户端的主要任务是**从分配的工作中提取指标**。

![image-20230706220808885](C:\Users\苏铄淼\AppData\Roaming\Typora\typora-user-images\image-20230706220808885.png)



![image-20230707092031009](C:\Users\苏铄淼\AppData\Roaming\Typora\typora-user-images\image-20230707092031009.png)

**研究结论**

本文介绍了 Cilantro，一个性能感知框架，用于在竞争作业之间分配有限的资源。其动机是：（i）资源分配策略应该具有**性能意识**，并基于生产环境中的实时反馈，（ii）调度程序应该适应不同的分配目标。设计Cilantro 来应对这些挑战，通过**将性能学习与策略解耦**，**并告知策略性能估计的不确定性**，从而能够在多租户和微服务设置中实现多种性能感知策略。